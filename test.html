<!DOCTYPE html>
<html>
    <body>
        <input autocomplete="off" id="name" />
        <div>
            <span data-adom-id="0">Hello, Matt!</span>
        </div>
        <button onclick="setName()">
            SET NAME
        </button>
    </body>
    <script>
    let nodes = [{"type":"textnode","chunks":[" Hello, ",["name"],"! "],"store_ref":true,"ref":0}]
    let adom = {
    	state: {"name":"Matt"},
    	update: function (obj) {
    		Object.assign(adom.state, obj)
    		
    		function get_value(v) {
    		  if (!Array.isArray(v)) return v
    		  v1 = adom.state
    		  v.forEach(function (i) {
    		    v1 = v1[i]
    		  })
    		  return v1
    		}
    		nodes.forEach(function (n) {
    		  if (n.type === "textnode" && n.store_ref) {
    		    let el = document.querySelector('span[data-adom-id="' + n.ref + '"]')
    		    el.innerHTML = n.chunks.map(get_value).join('').trim()
    		  } else if (n.attributes) {
    		    Object.keys(n.attributes).forEach(function (k) {
    		      if (Array.isArray(n.attributes[k])) {
    			let el = document.querySelector(n.name + '[data-adom-id="' + n.ref + '"]')
    			el[k] = get_value(n.attributes[k]) 
    		      }
    		    })
    		  }
    		})
    		
    		console.log(adom.state)
    	}
    }
    
    function setName () {
      let name = document.querySelector('#name').value
      adom.update({ name: name })
    }
    
    </script>
</html>
